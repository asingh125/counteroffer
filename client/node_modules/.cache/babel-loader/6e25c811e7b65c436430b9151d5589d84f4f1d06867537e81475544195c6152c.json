{"ast":null,"code":"'use strict';\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n    return extendStatics(d, b);\n  };\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n    r,\n    ar = [],\n    e;\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n  return ar;\n};\nvar __spreadArray = this && this.__spreadArray || function (to, from) {\n  for (var i = 0, il = from.length, j = to.length; i < il; i++, j++) to[j] = from[i];\n  return to;\n};\nvar constants = require('./constants');\nvar E = constants.typeErrors,\n  trackPriority = constants.trackPriority;\nvar util = require('../webrtc/util');\nvar sessionSID = require('./sid').sessionSID;\nvar TwilioWarning = require('./twiliowarning');\n/**\n * Return the given {@link LocalTrack} or a new {@link LocalTrack} for the\n * given MediaStreamTrack.\n * @param {LocalTrack|MediaStreamTrack} track\n * @param {object} options\n * @returns {LocalTrack}\n * @throws {TypeError}\n */\nfunction asLocalTrack(track, options) {\n  if (track instanceof options.LocalAudioTrack || track instanceof options.LocalVideoTrack || track instanceof options.LocalDataTrack) {\n    return track;\n  }\n  if (track instanceof options.MediaStreamTrack) {\n    return track.kind === 'audio' ? new options.LocalAudioTrack(track, options) : new options.LocalVideoTrack(track, options);\n  }\n  /* eslint new-cap:0 */\n  throw E.INVALID_TYPE('track', 'LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack');\n}\n/**\n * Create a new {@link LocalTrackPublication} for the given {@link LocalTrack}.\n * @param {LocalTrack} track\n * @param {LocalTrackPublicationSignaling} signaling\n * @param {function(track: LocalTrackPublication): void} unpublish\n * @param {object} options\n */\nfunction asLocalTrackPublication(track, signaling, unpublish, options) {\n  var LocalTrackPublication = {\n    audio: options.LocalAudioTrackPublication,\n    video: options.LocalVideoTrackPublication,\n    data: options.LocalDataTrackPublication\n  }[track.kind];\n  return new LocalTrackPublication(signaling, track, unpublish, options);\n}\n/**\n * Capitalize a word.\n * @param {string} word\n * @returns {string} capitalized\n */\nfunction capitalize(word) {\n  return word[0].toUpperCase() + word.slice(1);\n}\n/**\n * Log deprecation warnings for the given events of an EventEmitter.\n * @param {string} name\n * @param {EventEmitter} emitter\n * @param {Map<string, string>} events\n * @param {Log} log\n */\nfunction deprecateEvents(name, emitter, events, log) {\n  var warningsShown = new Set();\n  emitter.on('newListener', function newListener(event) {\n    if (events.has(event) && !warningsShown.has(event)) {\n      log.deprecated(name + \"#\" + event + \" has been deprecated and scheduled for removal in twilio-video.js@2.0.0.\" + (events.get(event) ? \" Use \" + name + \"#\" + events.get(event) + \" instead.\" : ''));\n      warningsShown.add(event);\n    }\n    if (warningsShown.size >= events.size) {\n      emitter.removeListener('newListener', newListener);\n    }\n  });\n}\n/**\n * Finds the items in list1 that are not in list2.\n * @param {Array<*>|Map<*>|Set<*>} list1\n * @param {Array<*>|Map<*>|Set<*>} list2\n * @returns {Set}\n */\nfunction difference(list1, list2) {\n  list1 = Array.isArray(list1) ? new Set(list1) : new Set(list1.values());\n  list2 = Array.isArray(list2) ? new Set(list2) : new Set(list2.values());\n  var difference = new Set();\n  list1.forEach(function (item) {\n    if (!list2.has(item)) {\n      difference.add(item);\n    }\n  });\n  return difference;\n}\n/**\n * Filter out the keys in an object with a given value.\n * @param {object} object - Object to be filtered\n * @param {*} [filterValue] - Value to be filtered out; If not specified, then\n *   filters out all keys which have an explicit value of \"undefined\"\n * @returns {object} - Filtered object\n */\nfunction filterObject(object, filterValue) {\n  return Object.keys(object).reduce(function (filtered, key) {\n    if (object[key] !== filterValue) {\n      filtered[key] = object[key];\n    }\n    return filtered;\n  }, {});\n}\n/**\n * Map a list to an array of arrays, and return the flattened result.\n * @param {Array<*>|Set<*>|Map<*>} list\n * @param {function(*): Array<*>} [mapFn]\n * @returns Array<*>\n */\nfunction flatMap(list, mapFn) {\n  var listArray = list instanceof Map || list instanceof Set ? Array.from(list.values()) : list;\n  mapFn = mapFn || function mapFn(item) {\n    return item;\n  };\n  return listArray.reduce(function (flattened, item) {\n    var mapped = mapFn(item);\n    return flattened.concat(mapped);\n  }, []);\n}\n/**\n * Get the user agent string, or return \"Unknown\".\n * @returns {string}\n */\nfunction getUserAgent() {\n  return typeof navigator !== 'undefined' && navigator.userAgent ? navigator.userAgent : 'Unknown';\n}\n/**\n * Get the platform component of the user agent string.\n * Example:\n *   Input - Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.82 Safari/537.36\n *   Output - macintosh\n * @returns {string}\n */\nfunction getPlatform() {\n  var userAgent = getUserAgent();\n  var _a = __read(userAgent.match(/\\(([^)]+)\\)/) || [], 2),\n    _b = _a[1],\n    match = _b === void 0 ? 'unknown' : _b;\n  var _c = __read(match.split(';').map(function (entry) {\n      return entry.trim();\n    }), 1),\n    platform = _c[0];\n  return platform.toLowerCase();\n}\n/**\n * Create a unique identifier.\n * @returns {string}\n */\nfunction makeUUID() {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n    var r = Math.random() * 16 | 0;\n    var v = c === 'x' ? r : r & 0x3 | 0x8;\n    return v.toString(16);\n  });\n}\n/**\n * Ensure that the given function is called once per tick.\n * @param {function} fn - Function to be executed\n * @returns {function} - Schedules the given function to be called on the next tick\n */\nfunction oncePerTick(fn) {\n  var timeout = null;\n  function nextTick() {\n    timeout = null;\n    fn();\n  }\n  return function scheduleNextTick() {\n    if (timeout) {\n      clearTimeout(timeout);\n    }\n    timeout = setTimeout(nextTick);\n  };\n}\nfunction promiseFromEvents(operation, eventEmitter, successEvent, failureEvent) {\n  return new Promise(function (resolve, reject) {\n    function onSuccess() {\n      var args = [].slice.call(arguments);\n      if (failureEvent) {\n        eventEmitter.removeListener(failureEvent, onFailure);\n      }\n      resolve.apply(void 0, __spreadArray([], __read(args)));\n    }\n    function onFailure() {\n      var args = [].slice.call(arguments);\n      eventEmitter.removeListener(successEvent, onSuccess);\n      reject.apply(void 0, __spreadArray([], __read(args)));\n    }\n    eventEmitter.once(successEvent, onSuccess);\n    if (failureEvent) {\n      eventEmitter.once(failureEvent, onFailure);\n    }\n    operation();\n  });\n}\n/**\n * Traverse down multiple nodes on an object and return null if\n * any link in the path is unavailable.\n * @param {Object} obj - Object to traverse\n * @param {String} path - Path to traverse. Period-separated.\n * @returns {Any|null}\n */\nfunction getOrNull(obj, path) {\n  return path.split('.').reduce(function (output, step) {\n    if (!output) {\n      return null;\n    }\n    return output[step];\n  }, obj);\n}\n/**\n * @typedef {object} Deferred\n * @property {Promise} promise\n * @property {function} reject\n * @property {function} resolve\n */\n/**\n * Create a {@link Deferred}.\n * @returns {Deferred}\n */\nfunction defer() {\n  var deferred = {};\n  deferred.promise = new Promise(function (resolve, reject) {\n    deferred.resolve = resolve;\n    deferred.reject = reject;\n  });\n  return deferred;\n}\n/**\n * Copy a method from a `source` prototype onto a `wrapper` prototype. Invoking\n * the method on the `wrapper` prototype will invoke the corresponding method\n * on an instance accessed by `target`.\n * @param {object} source\n * @param {object} wrapper\n * @param {string} target\n * @param {string} methodName\n * @returns {undefined}\n */\nfunction delegateMethod(source, wrapper, target, methodName) {\n  if (methodName in wrapper) {\n    // Skip any methods already set.\n    return;\n  } else if (methodName.match(/^on[a-z]+$/)) {\n    // Skip EventHandlers (these are handled in the constructor).\n    return;\n  }\n  var type;\n  try {\n    type = typeof source[methodName];\n  } catch (error) {\n    // NOTE(mroberts): Attempting to check the type of non-function members\n    // on the prototype throws an error for some types.\n  }\n  if (type !== 'function') {\n    // Skip non-function members.\n    return;\n  }\n  /* eslint no-loop-func:0 */\n  wrapper[methodName] = function () {\n    var _a;\n    var args = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n    return (_a = this[target])[methodName].apply(_a, __spreadArray([], __read(args)));\n  };\n}\n/**\n * Copy methods from a `source` prototype onto a `wrapper` prototype. Invoking\n * the methods on the `wrapper` prototype will invoke the corresponding method\n * on an instance accessed by `target`.\n * @param {object} source\n * @param {object} wrapper\n * @param {string} target\n * @returns {undefined}\n */\nfunction delegateMethods(source, wrapper, target) {\n  for (var methodName in source) {\n    delegateMethod(source, wrapper, target, methodName);\n  }\n}\n/**\n * Determine whether two values are deeply equal.\n * @param {*} val1\n * @param {*} val2\n * @returns {boolean}\n */\nfunction isDeepEqual(val1, val2) {\n  if (val1 === val2) {\n    return true;\n  }\n  if (typeof val1 !== typeof val2) {\n    return false;\n  }\n  if (val1 === null) {\n    return val2 === null;\n  }\n  if (val2 === null) {\n    return false;\n  }\n  if (Array.isArray(val1)) {\n    return Array.isArray(val2) && val1.length === val2.length && val1.every(function (val, i) {\n      return isDeepEqual(val, val2[i]);\n    });\n  }\n  if (typeof val1 === 'object') {\n    var val1Keys = Object.keys(val1).sort();\n    var val2Keys = Object.keys(val2).sort();\n    return !Array.isArray(val2) && isDeepEqual(val1Keys, val2Keys) && val1Keys.every(function (key) {\n      return isDeepEqual(val1[key], val2[key]);\n    });\n  }\n  return false;\n}\n/**\n * Whether the given argument is a non-array object.\n * @param {*} object\n * @return {boolean}\n */\nfunction isNonArrayObject(object) {\n  return typeof object === 'object' && !Array.isArray(object);\n}\n/**\n * For each property name on the `source` prototype, add getters and/or setters\n * to `wrapper` that proxy to `target`.\n * @param {object} source\n * @param {object} wrapper\n * @param {string} target\n * @returns {undefined}\n */\nfunction proxyProperties(source, wrapper, target) {\n  Object.getOwnPropertyNames(source).forEach(function (propertyName) {\n    proxyProperty(source, wrapper, target, propertyName);\n  });\n}\n/**\n * For the property name on the `source` prototype, add a getter and/or setter\n * to `wrapper` that proxies to `target`.\n * @param {object} source\n * @param {object} wrapper\n * @param {string} target\n * @param {string} propertyName\n * @returns {undefined}\n */\nfunction proxyProperty(source, wrapper, target, propertyName) {\n  if (propertyName in wrapper) {\n    // Skip any properties already set.\n    return;\n  } else if (propertyName.match(/^on[a-z]+$/)) {\n    Object.defineProperty(wrapper, propertyName, {\n      value: null,\n      writable: true\n    });\n    target.addEventListener(propertyName.slice(2), function () {\n      var args = [];\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n      wrapper.dispatchEvent.apply(wrapper, __spreadArray([], __read(args)));\n    });\n    return;\n  }\n  Object.defineProperty(wrapper, propertyName, {\n    enumerable: true,\n    get: function () {\n      return target[propertyName];\n    }\n  });\n}\n/**\n * This is a function for turning a Promise into the kind referenced in the\n * Legacy Interface Extensions section of the WebRTC spec.\n * @param {Promise<*>} promise\n * @param {function<*>} onSuccess\n * @param {function<Error>} onFailure\n * @returns {Promise<undefined>}\n */\nfunction legacyPromise(promise, onSuccess, onFailure) {\n  if (onSuccess) {\n    return promise.then(function (result) {\n      onSuccess(result);\n    }, function (error) {\n      onFailure(error);\n    });\n  }\n  return promise;\n}\n/**\n * Build the {@link LogLevels} object.\n * @param {String|LogLevel} logLevel - Log level name or object\n * @returns {LogLevels}\n */\nfunction buildLogLevels(logLevel) {\n  if (typeof logLevel === 'string') {\n    return {\n      default: logLevel,\n      media: logLevel,\n      signaling: logLevel,\n      webrtc: logLevel\n    };\n  }\n  return logLevel;\n}\n/**\n * Get the {@link Track}'s derived class name\n * @param {Track} track\n * @param {?boolean} [local=undefined]\n * @returns {string}\n */\nfunction trackClass(track, local) {\n  local = local ? 'Local' : '';\n  return local + (track.kind || '').replace(/\\w{1}/, function (m) {\n    return m.toUpperCase();\n  }) + \"Track\";\n}\n/**\n * Get the {@link TrackPublication}'s derived class name\n * @param {TrackPublication} publication\n * @param {?boolean} [local=undefined]\n * @returns {string}\n */\nfunction trackPublicationClass(publication, local) {\n  local = local ? 'Local' : '';\n  return local + (publication.kind || '').replace(/\\w{1}/, function (m) {\n    return m.toUpperCase();\n  }) + \"TrackPublication\";\n}\n/**\n * Sets all underscore-prefixed properties on `object` non-enumerable.\n * @param {Object} object\n * @returns {void}\n */\nfunction hidePrivateProperties(object) {\n  Object.getOwnPropertyNames(object).forEach(function (name) {\n    if (name.startsWith('_')) {\n      hideProperty(object, name);\n    }\n  });\n}\n/**\n * Creates a new subclass which, in the constructor, sets all underscore-prefixed\n * properties and the given public properties non-enumerable. This is useful for\n * patching up classes like EventEmitter which may set properties like `_events`\n * and `domain`.\n * @param {Function} klass\n * @param {Array<string>} props\n * @returns {Function} subclass\n */\nfunction hidePrivateAndCertainPublicPropertiesInClass(klass, props) {\n  // NOTE(mroberts): We do this to avoid giving the class a name.\n  return (/** @class */function (_super) {\n      __extends(class_1, _super);\n      function class_1() {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          args[_i] = arguments[_i];\n        }\n        var _this = _super.apply(this, __spreadArray([], __read(args))) || this;\n        hidePrivateProperties(_this);\n        hidePublicProperties(_this, props);\n        return _this;\n      }\n      return class_1;\n    }(klass)\n  );\n}\n/**\n * Hide a property of an object.\n * @param {object} object\n * @param {string} name\n */\nfunction hideProperty(object, name) {\n  var descriptor = Object.getOwnPropertyDescriptor(object, name);\n  descriptor.enumerable = false;\n  Object.defineProperty(object, name, descriptor);\n}\n/**\n * Hide the given public properties of an object.\n * @param {object} object\n * @param {Array<string>} [props=[]]\n */\nfunction hidePublicProperties(object, props) {\n  if (props === void 0) {\n    props = [];\n  }\n  props.forEach(function (name) {\n    // eslint-disable-next-line no-prototype-builtins\n    if (object.hasOwnProperty(name)) {\n      hideProperty(object, name);\n    }\n  });\n}\n/**\n * Convert an Array of values to an Array of JSON values by calling\n * `valueToJSON` on each value.\n * @param {Array<*>} array\n * @returns {Array<*>}\n */\nfunction arrayToJSON(array) {\n  return array.map(valueToJSON);\n}\n/**\n * Convert a Set of values to an Array of JSON values by calling `valueToJSON`\n * on each value.\n * @param {Set<*>} set\n * @returns {Array<*>}\n */\nfunction setToJSON(set) {\n  return arrayToJSON(__spreadArray([], __read(set)));\n}\n/**\n * Convert a Map from strings to values to an object of JSON values by calling\n * `valueToJSON` on each value.\n * @param {Map<string, *>} map\n * @returns {object}\n */\nfunction mapToJSON(map) {\n  return __spreadArray([], __read(map.entries())).reduce(function (json, _a) {\n    var _b;\n    var _c = __read(_a, 2),\n      key = _c[0],\n      value = _c[1];\n    return Object.assign((_b = {}, _b[key] = valueToJSON(value), _b), json);\n  }, {});\n}\n/**\n * Convert an object to a JSON value by calling `valueToJSON` on its enumerable\n * keys.\n * @param {object} object\n * @returns {object}\n */\nfunction objectToJSON(object) {\n  return Object.entries(object).reduce(function (json, _a) {\n    var _b;\n    var _c = __read(_a, 2),\n      key = _c[0],\n      value = _c[1];\n    return Object.assign((_b = {}, _b[key] = valueToJSON(value), _b), json);\n  }, {});\n}\n/**\n * Convert a value into a JSON value.\n * @param {*} value\n * @returns {*}\n */\nfunction valueToJSON(value) {\n  if (Array.isArray(value)) {\n    return arrayToJSON(value);\n  } else if (value instanceof Set) {\n    return setToJSON(value);\n  } else if (value instanceof Map) {\n    return mapToJSON(value);\n  } else if (value && typeof value === 'object') {\n    return objectToJSON(value);\n  }\n  return value;\n}\nfunction createRoomConnectEventPayload(connectOptions) {\n  function boolToString(val) {\n    return val ? 'true' : 'false';\n  }\n  var payload = {\n    sessionSID: sessionSID,\n    // arrays props converted to lengths.\n    iceServers: (connectOptions.iceServers || []).length,\n    audioTracks: (connectOptions.tracks || []).filter(function (track) {\n      return track.kind === 'audio';\n    }).length,\n    videoTracks: (connectOptions.tracks || []).filter(function (track) {\n      return track.kind === 'video';\n    }).length,\n    dataTracks: (connectOptions.tracks || []).filter(function (track) {\n      return track.kind === 'data';\n    }).length\n  };\n  // boolean properties.\n  [['audio'], ['automaticSubscription'], ['enableDscp'], ['eventListener'], ['preflight'], ['video'], ['dominantSpeaker', 'enableDominantSpeaker']].forEach(function (_a) {\n    var _b = __read(_a, 2),\n      prop = _b[0],\n      eventProp = _b[1];\n    eventProp = eventProp || prop;\n    payload[eventProp] = boolToString(!!connectOptions[prop]);\n  });\n  // numbers properties.\n  [['maxVideoBitrate'], ['maxAudioBitrate']].forEach(function (_a) {\n    var _b = __read(_a, 2),\n      prop = _b[0],\n      eventProp = _b[1];\n    eventProp = eventProp || prop;\n    if (typeof connectOptions[prop] === 'number') {\n      payload[eventProp] = connectOptions[prop];\n    } else if (!isNaN(Number(connectOptions[prop]))) {\n      payload[eventProp] = Number(connectOptions[prop]);\n    }\n  });\n  // string properties.\n  [['iceTransportPolicy'], ['region'], ['name', 'roomName']].forEach(function (_a) {\n    var _b = __read(_a, 2),\n      prop = _b[0],\n      eventProp = _b[1];\n    eventProp = eventProp || prop;\n    if (typeof connectOptions[prop] === 'string') {\n      payload[eventProp] = connectOptions[prop];\n    } else if (typeof connectOptions[prop] === 'number' && prop === 'name') {\n      payload[eventProp] = connectOptions[prop].toString();\n    }\n  });\n  // array props stringified.\n  ['preferredAudioCodecs', 'preferredVideoCodecs'].forEach(function (prop) {\n    if (prop in connectOptions) {\n      payload[prop] = JSON.stringify(connectOptions[prop]);\n    }\n  });\n  if ('networkQuality' in connectOptions) {\n    payload.networkQualityConfiguration = {};\n    if (isNonArrayObject(connectOptions.networkQuality)) {\n      ['local', 'remote'].forEach(function (prop) {\n        if (typeof connectOptions.networkQuality[prop] === 'number') {\n          payload.networkQualityConfiguration[prop] = connectOptions.networkQuality[prop];\n        }\n      });\n    } else {\n      payload.networkQualityConfiguration.remote = 0;\n      payload.networkQualityConfiguration.local = connectOptions.networkQuality ? 1 : 0;\n    }\n  }\n  if (connectOptions.bandwidthProfile && connectOptions.bandwidthProfile.video) {\n    var videoBPOptions_1 = connectOptions.bandwidthProfile.video || {};\n    payload.bandwidthProfileOptions = {};\n    ['mode', 'maxTracks', 'trackSwitchOffMode', 'dominantSpeakerPriority', 'maxSubscriptionBitrate', 'renderDimensions', 'contentPreferencesMode', 'clientTrackSwitchOffControl'].forEach(function (prop) {\n      if (typeof videoBPOptions_1[prop] === 'number' || typeof videoBPOptions_1[prop] === 'string') {\n        payload.bandwidthProfileOptions[prop] = videoBPOptions_1[prop];\n      } else if (typeof videoBPOptions_1[prop] === 'boolean') {\n        payload.bandwidthProfileOptions[prop] = boolToString(videoBPOptions_1[prop]);\n      } else if (typeof videoBPOptions_1[prop] === 'object') {\n        payload.bandwidthProfileOptions[prop] = JSON.stringify(videoBPOptions_1[prop]);\n      }\n    });\n  }\n  return {\n    group: 'room',\n    name: 'connect',\n    level: 'info',\n    payload: payload\n  };\n}\n/**\n * Create the bandwidth profile payload included in an RSP connect message.\n * @param {BandwidthProfileOptions} bandwidthProfile\n * @returns {object}\n */\nfunction createBandwidthProfilePayload(bandwidthProfile) {\n  return createRSPPayload(bandwidthProfile, [{\n    prop: 'video',\n    type: 'object',\n    transform: createBandwidthProfileVideoPayload\n  }]);\n}\n/**\n * Create the bandwidth profile video payload included in an RSP connect message.\n * @param {VideoBandwidthProfileOptions} bandwidthProfileVideo\n * @returns {object}\n */\nfunction createBandwidthProfileVideoPayload(bandwidthProfileVideo) {\n  return createRSPPayload(bandwidthProfileVideo, [{\n    prop: 'dominantSpeakerPriority',\n    type: 'string',\n    payloadProp: 'active_speaker_priority'\n  }, {\n    prop: 'maxSubscriptionBitrate',\n    type: 'number',\n    payloadProp: 'max_subscription_bandwidth'\n  }, {\n    prop: 'maxTracks',\n    type: 'number',\n    payloadProp: 'max_tracks'\n  }, {\n    prop: 'mode',\n    type: 'string'\n  }, {\n    prop: 'renderDimensions',\n    type: 'object',\n    payloadProp: 'render_dimensions',\n    transform: createRenderDimensionsPayload\n  }, {\n    prop: 'trackSwitchOffMode',\n    type: 'string',\n    payloadProp: 'track_switch_off'\n  }]);\n}\n/**\n * Create the Media Signaling payload included in an RSP connect message.\n * @param {boolean} dominantSpeaker - whether to enable the Dominant Speaker\n *   protocol or not\n * @param {boolean} networkQuality - whether to enable the Network Quality\n *   protocol or not\n * @param {boolean} trackPriority - whether to enable the Track Priority\n *   protocol or not\n * @param {boolean} trackSwitchOff - whether to enable the Track Switch-Off\n *   protocol or not.\n * @param {boolean} renderHints - whether to enable the renderHints\n *   protocol or not.\n * @returns {object}\n */\nfunction createMediaSignalingPayload(dominantSpeaker, networkQuality, trackPriority, trackSwitchOff, adaptiveSimulcast, renderHints) {\n  var transports = {\n    transports: [{\n      type: 'data-channel'\n    }]\n  };\n  return Object.assign(dominantSpeaker\n  // eslint-disable-next-line\n  ? {\n    active_speaker: transports\n  } : {}, networkQuality\n  // eslint-disable-next-line\n  ? {\n    network_quality: transports\n  } : {}, renderHints\n  // eslint-disable-next-line\n  ? {\n    render_hints: transports\n  } : {}, adaptiveSimulcast\n  // eslint-disable-next-line\n  ? {\n    publisher_hints: transports\n  } : {}, trackPriority\n  // eslint-disable-next-line\n  ? {\n    track_priority: transports\n  } : {}, trackSwitchOff\n  // eslint-disable-next-line\n  ? {\n    track_switch_off: transports\n  } : {});\n}\n/**\n * Create {@link VideoTrack.Dimensions} RSP payload.\n * @param {VideoTrack.Dimensions} [dimensions]\n * @returns {object}\n */\nfunction createDimensionsPayload(dimensions) {\n  return createRSPPayload(dimensions, [{\n    prop: 'height',\n    type: 'number'\n  }, {\n    prop: 'width',\n    type: 'number'\n  }]);\n}\n/**\n * Create {@link VideoRenderDimensions} RSP payload.\n * @param renderDimensions\n * @returns {object}\n */\nfunction createRenderDimensionsPayload(renderDimensions) {\n  var PRIORITY_HIGH = trackPriority.PRIORITY_HIGH,\n    PRIORITY_LOW = trackPriority.PRIORITY_LOW,\n    PRIORITY_STANDARD = trackPriority.PRIORITY_STANDARD;\n  return createRSPPayload(renderDimensions, [{\n    prop: PRIORITY_HIGH,\n    type: 'object',\n    transform: createDimensionsPayload\n  }, {\n    prop: PRIORITY_LOW,\n    type: 'object',\n    transform: createDimensionsPayload\n  }, {\n    prop: PRIORITY_STANDARD,\n    type: 'object',\n    transform: createDimensionsPayload\n  }]);\n}\n/**\n * Create an RSP payload for the given object.\n * @param {object} object - object for which RSP payload is to be generated\n * @param {Array<object>} propConversions - conversion rules for object properties;\n *   they specify how object properties should be converted to their corresponding\n *   RSP payload properties\n * @returns {object}\n */\nfunction createRSPPayload(object, propConversions) {\n  return propConversions.reduce(function (payload, _a) {\n    var _b;\n    var prop = _a.prop,\n      type = _a.type,\n      _c = _a.payloadProp,\n      payloadProp = _c === void 0 ? prop : _c,\n      _d = _a.transform,\n      transform = _d === void 0 ? function (x) {\n        return x;\n      } : _d;\n    return typeof object[prop] === type ? Object.assign((_b = {}, _b[payloadProp] = transform(object[prop]), _b), payload) : payload;\n  }, {});\n}\n/**\n * Create the subscribe payload included in an RSP connect/update message.\n * @param {boolean} automaticSubscription - whether to subscribe to all RemoteTracks\n * @returns {object}\n */\nfunction createSubscribePayload(automaticSubscription) {\n  return {\n    rules: [{\n      type: automaticSubscription ? 'include' : 'exclude',\n      all: true\n    }],\n    revision: 1\n  };\n}\nfunction createMediaWarningsPayload(notifyWarnings) {\n  var _a;\n  var mediaWarnings = (_a = {}, _a[TwilioWarning.recordingMediaLost] = 'recordings', _a);\n  return notifyWarnings.map(function (twilioWarningName) {\n    return mediaWarnings[twilioWarningName];\n  }).filter(function (name) {\n    return !!name;\n  });\n}\n/**\n * Add random jitter to a given value in the range [-jitter, jitter].\n * @private\n * @param {number} value\n * @param {number} jitter\n * @returns {number} value + random(-jitter, +jitter)\n */\nfunction withJitter(value, jitter) {\n  var rand = Math.random();\n  return value - jitter + Math.floor(2 * jitter * rand + 0.5);\n}\n/**\n * Checks if the a number is in the range [min, max].\n * @private\n * @param {num} num\n * @param {number} min\n * @param {number} max\n * @return {boolean}\n */\nfunction inRange(num, min, max) {\n  return min <= num && num <= max;\n}\n/**\n * returns true if given MediaStreamTrack is a screen share track\n * @private\n * @param {MediaStreamTrack} track\n * @returns {boolean}\n */\nfunction isChromeScreenShareTrack(track) {\n  // NOTE(mpatwardhan): Chrome creates screen share tracks with label like: \"screen:69734272*\"\n  // we will check for label that starts with \"screen:D\" where D being a digit.\n  return util.guessBrowser() === 'chrome' && track.kind === 'video' && 'displaySurface' in track.getSettings();\n}\n/**\n * returns true if given MediaStreamTrack is a user media track\n * @private\n * @param {MediaStreamTrack} track\n * @returns {boolean}\n */\nfunction isUserMediaTrack(track) {\n  // NOTE(mpatwardhan): tracks obtained from getUserMedia have a deviceId in its settings.\n  return typeof track.getSettings().deviceId === 'string';\n}\n/**\n * Returns a promise that resolve after timeoutMS have passed.\n * @param {number} timeoutMS - time to wait in milliseconds.\n * @returns {Promise<void>}\n */\nfunction waitForSometime(timeoutMS) {\n  if (timeoutMS === void 0) {\n    timeoutMS = 10;\n  }\n  return new Promise(function (resolve) {\n    return setTimeout(resolve, timeoutMS);\n  });\n}\n/**\n * Returns a promise that resolve after event is received\n * @returns {Promise<void>}\n */\nfunction waitForEvent(eventTarget, event) {\n  return new Promise(function (resolve) {\n    eventTarget.addEventListener(event, function onevent(e) {\n      eventTarget.removeEventListener(event, onevent);\n      resolve(e);\n    });\n  });\n}\nexports.constants = constants;\nexports.createBandwidthProfilePayload = createBandwidthProfilePayload;\nexports.createMediaSignalingPayload = createMediaSignalingPayload;\nexports.createMediaWarningsPayload = createMediaWarningsPayload;\nexports.createRoomConnectEventPayload = createRoomConnectEventPayload;\nexports.createSubscribePayload = createSubscribePayload;\nexports.asLocalTrack = asLocalTrack;\nexports.asLocalTrackPublication = asLocalTrackPublication;\nexports.capitalize = capitalize;\nexports.deprecateEvents = deprecateEvents;\nexports.difference = difference;\nexports.filterObject = filterObject;\nexports.flatMap = flatMap;\nexports.getPlatform = getPlatform;\nexports.getUserAgent = getUserAgent;\nexports.hidePrivateProperties = hidePrivateProperties;\nexports.hidePrivateAndCertainPublicPropertiesInClass = hidePrivateAndCertainPublicPropertiesInClass;\nexports.isDeepEqual = isDeepEqual;\nexports.isNonArrayObject = isNonArrayObject;\nexports.inRange = inRange;\nexports.makeUUID = makeUUID;\nexports.oncePerTick = oncePerTick;\nexports.promiseFromEvents = promiseFromEvents;\nexports.getOrNull = getOrNull;\nexports.defer = defer;\nexports.delegateMethods = delegateMethods;\nexports.proxyProperties = proxyProperties;\nexports.legacyPromise = legacyPromise;\nexports.buildLogLevels = buildLogLevels;\nexports.trackClass = trackClass;\nexports.trackPublicationClass = trackPublicationClass;\nexports.valueToJSON = valueToJSON;\nexports.withJitter = withJitter;\nexports.isChromeScreenShareTrack = isChromeScreenShareTrack;\nexports.isUserMediaTrack = isUserMediaTrack;\nexports.waitForSometime = waitForSometime;\nexports.waitForEvent = waitForEvent;","map":{"version":3,"mappings":"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","names":["constants","require","E","trackPriority","util","TwilioWarning","asLocalTrack","track","options","LocalAudioTrack","LocalVideoTrack","LocalDataTrack","MediaStreamTrack","kind","INVALID_TYPE","asLocalTrackPublication","signaling","unpublish","LocalTrackPublication","audio","LocalAudioTrackPublication","video","LocalVideoTrackPublication","data","LocalDataTrackPublication","capitalize","word","toUpperCase","slice","deprecateEvents","name","emitter","events","log","warningsShown","Set","on","newListener","event","has","deprecated","get","add","size","removeListener","difference","list1","list2","Array","isArray","values","forEach","item","filterObject","object","filterValue","Object","keys","reduce","filtered","key","flatMap","list","mapFn","listArray","Map","from","flattened","mapped","concat","getUserAgent","navigator","userAgent","getPlatform","match","_b","split","map","trim","platform","toLowerCase","makeUUID","replace","r","Math","random","v","c","toString","oncePerTick","fn","timeout","nextTick","scheduleNextTick","clearTimeout","setTimeout","promiseFromEvents","operation","eventEmitter","successEvent","failureEvent","Promise","resolve","reject","onSuccess","args","call","arguments","onFailure","once","getOrNull","obj","path","output","step","defer","deferred","promise","delegateMethod","source","wrapper","target","methodName","type","error","_i","delegateMethods","isDeepEqual","val1","val2","length","every","val","i","val1Keys","sort","val2Keys","isNonArrayObject","proxyProperties","getOwnPropertyNames","proxyProperty","propertyName","defineProperty","value","writable","addEventListener","dispatchEvent","enumerable","legacyPromise","then","result","buildLogLevels","logLevel","default","media","webrtc","trackClass","local","trackPublicationClass","publication","hidePrivateProperties","startsWith","hideProperty","hidePrivateAndCertainPublicPropertiesInClass","klass","props","__extends","_this","hidePublicProperties","descriptor","getOwnPropertyDescriptor","hasOwnProperty","arrayToJSON","array","valueToJSON","setToJSON","set","mapToJSON","__spreadArray","entries","json","_a","_c","assign","objectToJSON","createRoomConnectEventPayload","connectOptions","boolToString","payload","sessionSID","iceServers","audioTracks","tracks","filter","videoTracks","dataTracks","prop","eventProp","isNaN","Number","JSON","stringify","networkQualityConfiguration","networkQuality","remote","bandwidthProfile","videoBPOptions_1","bandwidthProfileOptions","group","level","createBandwidthProfilePayload","createRSPPayload","transform","createBandwidthProfileVideoPayload","bandwidthProfileVideo","payloadProp","createRenderDimensionsPayload","createMediaSignalingPayload","dominantSpeaker","trackSwitchOff","adaptiveSimulcast","renderHints","transports","active_speaker","network_quality","render_hints","publisher_hints","track_priority","track_switch_off","createDimensionsPayload","dimensions","renderDimensions","PRIORITY_LOW","PRIORITY_STANDARD","PRIORITY_HIGH","propConversions","_d","createSubscribePayload","automaticSubscription","rules","all","revision","createMediaWarningsPayload","notifyWarnings","mediaWarnings","recordingMediaLost","twilioWarningName","withJitter","jitter","rand","floor","inRange","num","min","max","isChromeScreenShareTrack","guessBrowser","getSettings","isUserMediaTrack","deviceId","waitForSometime","timeoutMS","waitForEvent","eventTarget","onevent","e","removeEventListener","exports"],"sources":["/Users/aarushisingh/Projects/counteroffer/client/node_modules/twilio-video/lib/util/index.js"],"sourcesContent":["'use strict';\n\nconst constants = require('./constants');\nconst { typeErrors: E, trackPriority } = constants;\nconst util = require('../webrtc/util');\nconst { sessionSID } = require('./sid');\nconst TwilioWarning = require('./twiliowarning');\n\n/**\n * Return the given {@link LocalTrack} or a new {@link LocalTrack} for the\n * given MediaStreamTrack.\n * @param {LocalTrack|MediaStreamTrack} track\n * @param {object} options\n * @returns {LocalTrack}\n * @throws {TypeError}\n */\nfunction asLocalTrack(track, options) {\n  if (track instanceof options.LocalAudioTrack\n    || track instanceof options.LocalVideoTrack\n    || track instanceof options.LocalDataTrack) {\n    return track;\n  }\n  if (track instanceof options.MediaStreamTrack) {\n    return track.kind === 'audio'\n      ? new options.LocalAudioTrack(track, options)\n      : new options.LocalVideoTrack(track, options);\n  }\n  /* eslint new-cap:0 */\n  throw E.INVALID_TYPE('track', 'LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack');\n}\n\n/**\n * Create a new {@link LocalTrackPublication} for the given {@link LocalTrack}.\n * @param {LocalTrack} track\n * @param {LocalTrackPublicationSignaling} signaling\n * @param {function(track: LocalTrackPublication): void} unpublish\n * @param {object} options\n */\nfunction asLocalTrackPublication(track, signaling, unpublish, options) {\n  const LocalTrackPublication = {\n    audio: options.LocalAudioTrackPublication,\n    video: options.LocalVideoTrackPublication,\n    data: options.LocalDataTrackPublication\n  }[track.kind];\n  return new LocalTrackPublication(signaling, track, unpublish, options);\n}\n\n/**\n * Capitalize a word.\n * @param {string} word\n * @returns {string} capitalized\n */\nfunction capitalize(word) {\n  return word[0].toUpperCase() + word.slice(1);\n}\n\n/**\n * Log deprecation warnings for the given events of an EventEmitter.\n * @param {string} name\n * @param {EventEmitter} emitter\n * @param {Map<string, string>} events\n * @param {Log} log\n */\nfunction deprecateEvents(name, emitter, events, log) {\n  const warningsShown = new Set();\n  emitter.on('newListener', function newListener(event) {\n    if (events.has(event) && !warningsShown.has(event)) {\n      log.deprecated(`${name}#${event} has been deprecated and scheduled for removal in twilio-video.js@2.0.0.${events.get(event)\n        ? ` Use ${name}#${events.get(event)} instead.`\n        : ''}`);\n      warningsShown.add(event);\n    }\n    if (warningsShown.size >= events.size) {\n      emitter.removeListener('newListener', newListener);\n    }\n  });\n}\n\n/**\n * Finds the items in list1 that are not in list2.\n * @param {Array<*>|Map<*>|Set<*>} list1\n * @param {Array<*>|Map<*>|Set<*>} list2\n * @returns {Set}\n */\nfunction difference(list1, list2) {\n  list1 = Array.isArray(list1) ? new Set(list1) : new Set(list1.values());\n  list2 = Array.isArray(list2) ? new Set(list2) : new Set(list2.values());\n\n  const difference = new Set();\n\n  list1.forEach(item => {\n    if (!list2.has(item)) {\n      difference.add(item);\n    }\n  });\n\n  return difference;\n}\n\n/**\n * Filter out the keys in an object with a given value.\n * @param {object} object - Object to be filtered\n * @param {*} [filterValue] - Value to be filtered out; If not specified, then\n *   filters out all keys which have an explicit value of \"undefined\"\n * @returns {object} - Filtered object\n */\nfunction filterObject(object, filterValue) {\n  return Object.keys(object).reduce((filtered, key) => {\n    if (object[key] !== filterValue) {\n      filtered[key] = object[key];\n    }\n    return filtered;\n  }, {});\n}\n\n/**\n * Map a list to an array of arrays, and return the flattened result.\n * @param {Array<*>|Set<*>|Map<*>} list\n * @param {function(*): Array<*>} [mapFn]\n * @returns Array<*>\n */\nfunction flatMap(list, mapFn) {\n  const listArray = list instanceof Map || list instanceof Set\n    ? Array.from(list.values())\n    : list;\n\n  mapFn = mapFn || function mapFn(item) {\n    return item;\n  };\n\n  return listArray.reduce((flattened, item) => {\n    const mapped = mapFn(item);\n    return flattened.concat(mapped);\n  }, []);\n}\n\n/**\n * Get the user agent string, or return \"Unknown\".\n * @returns {string}\n */\nfunction getUserAgent() {\n  return typeof navigator !== 'undefined' && navigator.userAgent\n    ? navigator.userAgent\n    : 'Unknown';\n}\n\n/**\n * Get the platform component of the user agent string.\n * Example:\n *   Input - Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.82 Safari/537.36\n *   Output - macintosh\n * @returns {string}\n */\nfunction getPlatform() {\n  const userAgent = getUserAgent();\n  const [, match = 'unknown'] = userAgent.match(/\\(([^)]+)\\)/) || [];\n  const [platform] = match.split(';').map(entry => entry.trim());\n  return platform.toLowerCase();\n}\n\n/**\n * Create a unique identifier.\n * @returns {string}\n */\nfunction makeUUID() {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {\n    const r = Math.random() * 16 | 0;\n    const v = c === 'x' ? r : (r & 0x3 | 0x8);\n    return v.toString(16);\n  });\n}\n\n/**\n * Ensure that the given function is called once per tick.\n * @param {function} fn - Function to be executed\n * @returns {function} - Schedules the given function to be called on the next tick\n */\nfunction oncePerTick(fn) {\n  let timeout = null;\n\n  function nextTick() {\n    timeout = null;\n    fn();\n  }\n\n  return function scheduleNextTick() {\n    if (timeout) {\n      clearTimeout(timeout);\n    }\n    timeout = setTimeout(nextTick);\n  };\n}\n\nfunction promiseFromEvents(operation, eventEmitter, successEvent, failureEvent) {\n  return new Promise((resolve, reject) => {\n    function onSuccess() {\n      const args = [].slice.call(arguments);\n      if (failureEvent) {\n        eventEmitter.removeListener(failureEvent, onFailure);\n      }\n      resolve(...args);\n    }\n    function onFailure() {\n      const args = [].slice.call(arguments);\n      eventEmitter.removeListener(successEvent, onSuccess);\n      reject(...args);\n    }\n    eventEmitter.once(successEvent, onSuccess);\n    if (failureEvent) {\n      eventEmitter.once(failureEvent, onFailure);\n    }\n    operation();\n  });\n}\n\n/**\n * Traverse down multiple nodes on an object and return null if\n * any link in the path is unavailable.\n * @param {Object} obj - Object to traverse\n * @param {String} path - Path to traverse. Period-separated.\n * @returns {Any|null}\n */\nfunction getOrNull(obj, path) {\n  return path.split('.').reduce((output, step) => {\n    if (!output) { return null; }\n    return output[step];\n  }, obj);\n}\n\n/**\n * @typedef {object} Deferred\n * @property {Promise} promise\n * @property {function} reject\n * @property {function} resolve\n */\n\n/**\n * Create a {@link Deferred}.\n * @returns {Deferred}\n */\nfunction defer() {\n  const deferred = {};\n  deferred.promise = new Promise((resolve, reject) => {\n    deferred.resolve = resolve;\n    deferred.reject = reject;\n  });\n  return deferred;\n}\n\n/**\n * Copy a method from a `source` prototype onto a `wrapper` prototype. Invoking\n * the method on the `wrapper` prototype will invoke the corresponding method\n * on an instance accessed by `target`.\n * @param {object} source\n * @param {object} wrapper\n * @param {string} target\n * @param {string} methodName\n * @returns {undefined}\n */\nfunction delegateMethod(source, wrapper, target, methodName) {\n  if (methodName in wrapper) {\n    // Skip any methods already set.\n    return;\n  } else if (methodName.match(/^on[a-z]+$/)) {\n    // Skip EventHandlers (these are handled in the constructor).\n    return;\n  }\n\n  let type;\n  try {\n    type = typeof source[methodName];\n  } catch (error) {\n    // NOTE(mroberts): Attempting to check the type of non-function members\n    // on the prototype throws an error for some types.\n  }\n\n  if (type !== 'function') {\n    // Skip non-function members.\n    return;\n  }\n\n  /* eslint no-loop-func:0 */\n  wrapper[methodName] = function(...args) {\n    return this[target][methodName](...args);\n  };\n}\n\n/**\n * Copy methods from a `source` prototype onto a `wrapper` prototype. Invoking\n * the methods on the `wrapper` prototype will invoke the corresponding method\n * on an instance accessed by `target`.\n * @param {object} source\n * @param {object} wrapper\n * @param {string} target\n * @returns {undefined}\n */\nfunction delegateMethods(source, wrapper, target) {\n  for (const methodName in source) {\n    delegateMethod(source, wrapper, target, methodName);\n  }\n}\n\n/**\n * Determine whether two values are deeply equal.\n * @param {*} val1\n * @param {*} val2\n * @returns {boolean}\n */\nfunction isDeepEqual(val1, val2) {\n  if (val1 === val2) {\n    return true;\n  }\n  if (typeof val1 !== typeof val2) {\n    return false;\n  }\n  if (val1 === null) {\n    return val2 === null;\n  }\n  if (val2 === null) {\n    return false;\n  }\n  if (Array.isArray(val1)) {\n    return Array.isArray(val2)\n      && val1.length === val2.length\n      && val1.every((val, i) => isDeepEqual(val, val2[i]));\n  }\n  if (typeof val1 === 'object') {\n    const val1Keys = Object.keys(val1).sort();\n    const val2Keys = Object.keys(val2).sort();\n    return !Array.isArray(val2)\n      && isDeepEqual(val1Keys, val2Keys)\n      && val1Keys.every(key => isDeepEqual(val1[key], val2[key]));\n  }\n  return false;\n}\n\n/**\n * Whether the given argument is a non-array object.\n * @param {*} object\n * @return {boolean}\n */\nfunction isNonArrayObject(object) {\n  return typeof object === 'object' && !Array.isArray(object);\n}\n\n/**\n * For each property name on the `source` prototype, add getters and/or setters\n * to `wrapper` that proxy to `target`.\n * @param {object} source\n * @param {object} wrapper\n * @param {string} target\n * @returns {undefined}\n */\nfunction proxyProperties(source, wrapper, target) {\n  Object.getOwnPropertyNames(source).forEach(propertyName => {\n    proxyProperty(source, wrapper, target, propertyName);\n  });\n}\n\n/**\n * For the property name on the `source` prototype, add a getter and/or setter\n * to `wrapper` that proxies to `target`.\n * @param {object} source\n * @param {object} wrapper\n * @param {string} target\n * @param {string} propertyName\n * @returns {undefined}\n */\nfunction proxyProperty(source, wrapper, target, propertyName) {\n  if (propertyName in wrapper) {\n    // Skip any properties already set.\n    return;\n  } else if (propertyName.match(/^on[a-z]+$/)) {\n    Object.defineProperty(wrapper, propertyName, {\n      value: null,\n      writable: true\n    });\n\n    target.addEventListener(propertyName.slice(2), function(...args) {\n      wrapper.dispatchEvent(...args);\n    });\n\n    return;\n  }\n\n  Object.defineProperty(wrapper, propertyName, {\n    enumerable: true,\n    get() {\n      return target[propertyName];\n    }\n  });\n}\n\n/**\n * This is a function for turning a Promise into the kind referenced in the\n * Legacy Interface Extensions section of the WebRTC spec.\n * @param {Promise<*>} promise\n * @param {function<*>} onSuccess\n * @param {function<Error>} onFailure\n * @returns {Promise<undefined>}\n */\nfunction legacyPromise(promise, onSuccess, onFailure) {\n  if (onSuccess) {\n    return promise.then(result => {\n      onSuccess(result);\n    }, error => {\n      onFailure(error);\n    });\n  }\n  return promise;\n}\n\n/**\n * Build the {@link LogLevels} object.\n * @param {String|LogLevel} logLevel - Log level name or object\n * @returns {LogLevels}\n */\nfunction buildLogLevels(logLevel) {\n  if (typeof logLevel === 'string') {\n    return {\n      default: logLevel,\n      media: logLevel,\n      signaling: logLevel,\n      webrtc: logLevel\n    };\n  }\n  return logLevel;\n}\n\n/**\n * Get the {@link Track}'s derived class name\n * @param {Track} track\n * @param {?boolean} [local=undefined]\n * @returns {string}\n */\nfunction trackClass(track, local) {\n  local = local ? 'Local' : '';\n  return `${local + (track.kind || '').replace(/\\w{1}/, m => m.toUpperCase())}Track`;\n}\n\n/**\n * Get the {@link TrackPublication}'s derived class name\n * @param {TrackPublication} publication\n * @param {?boolean} [local=undefined]\n * @returns {string}\n */\nfunction trackPublicationClass(publication, local) {\n  local = local ? 'Local' : '';\n  return `${local + (publication.kind || '').replace(/\\w{1}/, m => m.toUpperCase())}TrackPublication`;\n}\n\n/**\n * Sets all underscore-prefixed properties on `object` non-enumerable.\n * @param {Object} object\n * @returns {void}\n */\nfunction hidePrivateProperties(object) {\n  Object.getOwnPropertyNames(object).forEach(name => {\n    if (name.startsWith('_')) {\n      hideProperty(object, name);\n    }\n  });\n}\n\n/**\n * Creates a new subclass which, in the constructor, sets all underscore-prefixed\n * properties and the given public properties non-enumerable. This is useful for\n * patching up classes like EventEmitter which may set properties like `_events`\n * and `domain`.\n * @param {Function} klass\n * @param {Array<string>} props\n * @returns {Function} subclass\n */\nfunction hidePrivateAndCertainPublicPropertiesInClass(klass, props) {\n  // NOTE(mroberts): We do this to avoid giving the class a name.\n  return class extends klass {\n    constructor(...args) {\n      super(...args);\n      hidePrivateProperties(this);\n      hidePublicProperties(this, props);\n    }\n  };\n}\n\n/**\n * Hide a property of an object.\n * @param {object} object\n * @param {string} name\n */\nfunction hideProperty(object, name) {\n  const descriptor = Object.getOwnPropertyDescriptor(object, name);\n  descriptor.enumerable = false;\n  Object.defineProperty(object, name, descriptor);\n}\n\n/**\n * Hide the given public properties of an object.\n * @param {object} object\n * @param {Array<string>} [props=[]]\n */\nfunction hidePublicProperties(object, props = []) {\n  props.forEach(name => {\n    // eslint-disable-next-line no-prototype-builtins\n    if (object.hasOwnProperty(name)) {\n      hideProperty(object, name);\n    }\n  });\n}\n\n/**\n * Convert an Array of values to an Array of JSON values by calling\n * `valueToJSON` on each value.\n * @param {Array<*>} array\n * @returns {Array<*>}\n */\nfunction arrayToJSON(array) {\n  return array.map(valueToJSON);\n}\n\n/**\n * Convert a Set of values to an Array of JSON values by calling `valueToJSON`\n * on each value.\n * @param {Set<*>} set\n * @returns {Array<*>}\n */\nfunction setToJSON(set) {\n  return arrayToJSON([...set]);\n}\n\n/**\n * Convert a Map from strings to values to an object of JSON values by calling\n * `valueToJSON` on each value.\n * @param {Map<string, *>} map\n * @returns {object}\n */\nfunction mapToJSON(map) {\n  return [...map.entries()].reduce((json, [key, value]) => {\n    return Object.assign({ [key]: valueToJSON(value) }, json);\n  }, {});\n}\n\n/**\n * Convert an object to a JSON value by calling `valueToJSON` on its enumerable\n * keys.\n * @param {object} object\n * @returns {object}\n */\nfunction objectToJSON(object) {\n  return Object.entries(object).reduce((json, [key, value]) => {\n    return Object.assign({ [key]: valueToJSON(value) }, json);\n  }, {});\n}\n\n/**\n * Convert a value into a JSON value.\n * @param {*} value\n * @returns {*}\n */\nfunction valueToJSON(value) {\n  if (Array.isArray(value)) {\n    return arrayToJSON(value);\n  } else if (value instanceof Set) {\n    return setToJSON(value);\n  } else if (value instanceof Map) {\n    return mapToJSON(value);\n  } else if (value && typeof value === 'object') {\n    return objectToJSON(value);\n  }\n  return value;\n}\n\nfunction createRoomConnectEventPayload(connectOptions) {\n  function boolToString(val) {\n    return val ? 'true' : 'false';\n  }\n  const payload = {\n    sessionSID,\n\n    // arrays props converted to lengths.\n    iceServers: (connectOptions.iceServers || []).length,\n    audioTracks: (connectOptions.tracks || []).filter(track => track.kind === 'audio').length,\n    videoTracks: (connectOptions.tracks || []).filter(track => track.kind === 'video').length,\n    dataTracks: (connectOptions.tracks || []).filter(track => track.kind === 'data').length,\n  };\n\n  // boolean properties.\n  [['audio'], ['automaticSubscription'], ['enableDscp'], ['eventListener'], ['preflight'], ['video'], ['dominantSpeaker', 'enableDominantSpeaker']].forEach(([prop, eventProp]) => {\n    eventProp = eventProp || prop;\n    payload[eventProp] = boolToString(!!connectOptions[prop]);\n  });\n\n  // numbers properties.\n  [['maxVideoBitrate'], ['maxAudioBitrate']].forEach(([prop, eventProp]) => {\n    eventProp = eventProp || prop;\n    if (typeof connectOptions[prop] === 'number') {\n      payload[eventProp] = connectOptions[prop];\n    } else if (!isNaN(Number(connectOptions[prop]))) {\n      payload[eventProp] = Number(connectOptions[prop]);\n    }\n  });\n\n  // string properties.\n  [['iceTransportPolicy'], ['region'], ['name', 'roomName']].forEach(([prop, eventProp]) => {\n    eventProp = eventProp || prop;\n    if (typeof connectOptions[prop] === 'string') {\n      payload[eventProp] = connectOptions[prop];\n    } else if (typeof connectOptions[prop] === 'number' && prop === 'name') {\n      payload[eventProp] = connectOptions[prop].toString();\n    }\n  });\n\n  // array props stringified.\n  ['preferredAudioCodecs', 'preferredVideoCodecs'].forEach(prop => {\n    if (prop in connectOptions) {\n      payload[prop] = JSON.stringify(connectOptions[prop]);\n    }\n  });\n\n  if ('networkQuality' in connectOptions) {\n    payload.networkQualityConfiguration = {};\n    if (isNonArrayObject(connectOptions.networkQuality)) {\n      ['local', 'remote'].forEach(prop => {\n        if (typeof connectOptions.networkQuality[prop] === 'number') {\n          payload.networkQualityConfiguration[prop] = connectOptions.networkQuality[prop];\n        }\n      });\n    } else {\n      payload.networkQualityConfiguration.remote = 0;\n      payload.networkQualityConfiguration.local = connectOptions.networkQuality ? 1 : 0;\n    }\n  }\n\n  if (connectOptions.bandwidthProfile && connectOptions.bandwidthProfile.video) {\n    const videoBPOptions = connectOptions.bandwidthProfile.video || {};\n    payload.bandwidthProfileOptions = {};\n    ['mode', 'maxTracks', 'trackSwitchOffMode', 'dominantSpeakerPriority', 'maxSubscriptionBitrate', 'renderDimensions', 'contentPreferencesMode', 'clientTrackSwitchOffControl'].forEach(prop => {\n      if (typeof videoBPOptions[prop] === 'number' || typeof videoBPOptions[prop] === 'string') {\n        payload.bandwidthProfileOptions[prop] = videoBPOptions[prop];\n      } else if (typeof videoBPOptions[prop] === 'boolean') {\n        payload.bandwidthProfileOptions[prop] = boolToString(videoBPOptions[prop]);\n      } else if (typeof videoBPOptions[prop] === 'object') {\n        payload.bandwidthProfileOptions[prop] = JSON.stringify(videoBPOptions[prop]);\n      }\n    });\n  }\n\n  return {\n    group: 'room',\n    name: 'connect',\n    level: 'info',\n    payload\n  };\n}\n\n/**\n * Create the bandwidth profile payload included in an RSP connect message.\n * @param {BandwidthProfileOptions} bandwidthProfile\n * @returns {object}\n */\nfunction createBandwidthProfilePayload(bandwidthProfile) {\n  return createRSPPayload(bandwidthProfile, [\n    { prop: 'video', type: 'object', transform: createBandwidthProfileVideoPayload }\n  ]);\n}\n\n/**\n * Create the bandwidth profile video payload included in an RSP connect message.\n * @param {VideoBandwidthProfileOptions} bandwidthProfileVideo\n * @returns {object}\n */\nfunction createBandwidthProfileVideoPayload(bandwidthProfileVideo) {\n  return createRSPPayload(bandwidthProfileVideo, [\n    { prop: 'dominantSpeakerPriority', type: 'string', payloadProp: 'active_speaker_priority' },\n    { prop: 'maxSubscriptionBitrate', type: 'number', payloadProp: 'max_subscription_bandwidth' },\n    { prop: 'maxTracks', type: 'number', payloadProp: 'max_tracks' },\n    { prop: 'mode', type: 'string' },\n    { prop: 'renderDimensions', type: 'object', payloadProp: 'render_dimensions', transform: createRenderDimensionsPayload },\n    { prop: 'trackSwitchOffMode', type: 'string', payloadProp: 'track_switch_off' }\n  ]);\n}\n\n/**\n * Create the Media Signaling payload included in an RSP connect message.\n * @param {boolean} dominantSpeaker - whether to enable the Dominant Speaker\n *   protocol or not\n * @param {boolean} networkQuality - whether to enable the Network Quality\n *   protocol or not\n * @param {boolean} trackPriority - whether to enable the Track Priority\n *   protocol or not\n * @param {boolean} trackSwitchOff - whether to enable the Track Switch-Off\n *   protocol or not.\n * @param {boolean} renderHints - whether to enable the renderHints\n *   protocol or not.\n * @returns {object}\n */\nfunction createMediaSignalingPayload(dominantSpeaker, networkQuality, trackPriority, trackSwitchOff, adaptiveSimulcast, renderHints) {\n  const transports = { transports: [{ type: 'data-channel' }] };\n  return Object.assign(\n    dominantSpeaker\n      // eslint-disable-next-line\n      ? { active_speaker: transports }\n      : {},\n    networkQuality\n      // eslint-disable-next-line\n      ? { network_quality: transports }\n      : {},\n    renderHints\n      // eslint-disable-next-line\n      ? { render_hints: transports }\n      : {},\n    adaptiveSimulcast\n      // eslint-disable-next-line\n      ? { publisher_hints: transports }\n      : {},\n    trackPriority\n      // eslint-disable-next-line\n      ? { track_priority: transports }\n      : {},\n    trackSwitchOff\n      // eslint-disable-next-line\n      ? { track_switch_off: transports }\n      : {}\n  );\n}\n\n/**\n * Create {@link VideoTrack.Dimensions} RSP payload.\n * @param {VideoTrack.Dimensions} [dimensions]\n * @returns {object}\n */\nfunction createDimensionsPayload(dimensions) {\n  return createRSPPayload(dimensions, [\n    { prop: 'height', type: 'number' },\n    { prop: 'width', type: 'number' }\n  ]);\n}\n\n/**\n * Create {@link VideoRenderDimensions} RSP payload.\n * @param renderDimensions\n * @returns {object}\n */\nfunction createRenderDimensionsPayload(renderDimensions) {\n  const { PRIORITY_HIGH, PRIORITY_LOW, PRIORITY_STANDARD } = trackPriority;\n  return createRSPPayload(renderDimensions, [\n    { prop: PRIORITY_HIGH, type: 'object', transform: createDimensionsPayload },\n    { prop: PRIORITY_LOW, type: 'object', transform: createDimensionsPayload },\n    { prop: PRIORITY_STANDARD, type: 'object', transform: createDimensionsPayload }\n  ]);\n}\n\n/**\n * Create an RSP payload for the given object.\n * @param {object} object - object for which RSP payload is to be generated\n * @param {Array<object>} propConversions - conversion rules for object properties;\n *   they specify how object properties should be converted to their corresponding\n *   RSP payload properties\n * @returns {object}\n */\nfunction createRSPPayload(object, propConversions) {\n  return propConversions.reduce((payload, { prop, type, payloadProp = prop, transform = x => x }) => {\n    return typeof object[prop] === type\n      ? Object.assign({ [payloadProp]: transform(object[prop]) }, payload)\n      : payload;\n  }, {});\n}\n\n/**\n * Create the subscribe payload included in an RSP connect/update message.\n * @param {boolean} automaticSubscription - whether to subscribe to all RemoteTracks\n * @returns {object}\n */\nfunction createSubscribePayload(automaticSubscription) {\n  return {\n    rules: [{\n      type: automaticSubscription ? 'include' : 'exclude',\n      all: true\n    }],\n    revision: 1\n  };\n}\n\nfunction createMediaWarningsPayload(notifyWarnings) {\n  const mediaWarnings = {\n    [TwilioWarning.recordingMediaLost]: 'recordings'\n  };\n  return notifyWarnings\n    .map(twilioWarningName => mediaWarnings[twilioWarningName])\n    .filter(name => !!name);\n}\n\n/**\n * Add random jitter to a given value in the range [-jitter, jitter].\n * @private\n * @param {number} value\n * @param {number} jitter\n * @returns {number} value + random(-jitter, +jitter)\n */\nfunction withJitter(value, jitter) {\n  const rand = Math.random();\n  return value - jitter + Math.floor(2 * jitter * rand + 0.5);\n}\n\n/**\n * Checks if the a number is in the range [min, max].\n * @private\n * @param {num} num\n * @param {number} min\n * @param {number} max\n * @return {boolean}\n */\nfunction inRange(num, min, max) {\n  return min <= num && num <= max;\n}\n\n/**\n * returns true if given MediaStreamTrack is a screen share track\n * @private\n * @param {MediaStreamTrack} track\n * @returns {boolean}\n */\nfunction isChromeScreenShareTrack(track) {\n  // NOTE(mpatwardhan): Chrome creates screen share tracks with label like: \"screen:69734272*\"\n  // we will check for label that starts with \"screen:D\" where D being a digit.\n  return util.guessBrowser() === 'chrome' && track.kind === 'video' && 'displaySurface' in track.getSettings();\n}\n\n\n/**\n * returns true if given MediaStreamTrack is a user media track\n * @private\n * @param {MediaStreamTrack} track\n * @returns {boolean}\n */\nfunction isUserMediaTrack(track) {\n  // NOTE(mpatwardhan): tracks obtained from getUserMedia have a deviceId in its settings.\n  return typeof track.getSettings().deviceId === 'string';\n}\n\n/**\n * Returns a promise that resolve after timeoutMS have passed.\n * @param {number} timeoutMS - time to wait in milliseconds.\n * @returns {Promise<void>}\n */\nfunction waitForSometime(timeoutMS = 10) {\n  return new Promise(resolve => setTimeout(resolve, timeoutMS));\n}\n\n/**\n * Returns a promise that resolve after event is received\n * @returns {Promise<void>}\n */\nfunction waitForEvent(eventTarget, event) {\n  return new Promise(resolve => {\n    eventTarget.addEventListener(event, function onevent(e) {\n      eventTarget.removeEventListener(event, onevent);\n      resolve(e);\n    });\n  });\n}\n\nexports.constants = constants;\nexports.createBandwidthProfilePayload = createBandwidthProfilePayload;\nexports.createMediaSignalingPayload = createMediaSignalingPayload;\nexports.createMediaWarningsPayload = createMediaWarningsPayload;\nexports.createRoomConnectEventPayload = createRoomConnectEventPayload;\nexports.createSubscribePayload = createSubscribePayload;\nexports.asLocalTrack = asLocalTrack;\nexports.asLocalTrackPublication = asLocalTrackPublication;\nexports.capitalize = capitalize;\nexports.deprecateEvents = deprecateEvents;\nexports.difference = difference;\nexports.filterObject = filterObject;\nexports.flatMap = flatMap;\nexports.getPlatform = getPlatform;\nexports.getUserAgent = getUserAgent;\nexports.hidePrivateProperties = hidePrivateProperties;\nexports.hidePrivateAndCertainPublicPropertiesInClass = hidePrivateAndCertainPublicPropertiesInClass;\nexports.isDeepEqual = isDeepEqual;\nexports.isNonArrayObject = isNonArrayObject;\nexports.inRange = inRange;\nexports.makeUUID = makeUUID;\nexports.oncePerTick = oncePerTick;\nexports.promiseFromEvents = promiseFromEvents;\nexports.getOrNull = getOrNull;\nexports.defer = defer;\nexports.delegateMethods = delegateMethods;\nexports.proxyProperties = proxyProperties;\nexports.legacyPromise = legacyPromise;\nexports.buildLogLevels = buildLogLevels;\nexports.trackClass = trackClass;\nexports.trackPublicationClass = trackPublicationClass;\nexports.valueToJSON = valueToJSON;\nexports.withJitter = withJitter;\nexports.isChromeScreenShareTrack = isChromeScreenShareTrack;\nexports.isUserMediaTrack = isUserMediaTrack;\nexports.waitForSometime = waitForSometime;\nexports.waitForEvent = waitForEvent;\n"]},"metadata":{},"sourceType":"script","externalDependencies":[]}