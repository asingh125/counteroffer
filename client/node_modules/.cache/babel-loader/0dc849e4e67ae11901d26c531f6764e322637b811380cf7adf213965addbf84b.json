{"ast":null,"code":"/* eslint callback-return:0 */\n'use strict';\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n    return extendStatics(d, b);\n  };\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n    r,\n    ar = [],\n    e;\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n  return ar;\n};\nvar EventEmitter = require('events');\nvar PeerConnectionReportFactory = require('../../stats/peerconnectionreportfactory');\n/**\n * @emits NetworkQualityMonitor#updated\n */\nvar NetworkQualityMonitor = /** @class */function (_super) {\n  __extends(NetworkQualityMonitor, _super);\n  /**\n   * Construct a {@link NetworkQualityMonitor}.\n   * @param {PeerConnectionManager} manager\n   * @param {NetworkQualitySignaling} signaling\n   */\n  function NetworkQualityMonitor(manager, signaling) {\n    var _this = _super.call(this) || this;\n    Object.defineProperties(_this, {\n      _factories: {\n        value: new WeakMap()\n      },\n      _manager: {\n        value: manager\n      },\n      _signaling: {\n        value: signaling\n      }\n    });\n    signaling.on('updated', function () {\n      return _this.emit('updated');\n    });\n    return _this;\n  }\n  Object.defineProperty(NetworkQualityMonitor.prototype, \"level\", {\n    /**\n     * Get the current {@link NetworkQualityLevel}, if any.\n     * @returns {?NetworkQualityLevel} level - initially null\n     */\n    get: function () {\n      return this._signaling.level;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(NetworkQualityMonitor.prototype, \"levels\", {\n    /**\n     * Get the current {@link NetworkQualityLevels}, if any.\n     * @returns {?NetworkQualityLevels} levels - initially null\n     */\n    get: function () {\n      return this._signaling.levels;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(NetworkQualityMonitor.prototype, \"remoteLevels\", {\n    /**\n     * Get the current {@link NetworkQualityLevels} of remote participants, if any.\n     * @returns {Map<String, NetworkQualityLevels>} remoteLevels\n     */\n    get: function () {\n      return this._signaling.remoteLevels;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /**\n   * Start monitoring.\n   * @returns {void}\n   */\n  NetworkQualityMonitor.prototype.start = function () {\n    var _this = this;\n    this.stop();\n    var timeout = setTimeout(function () {\n      if (_this._timeout !== timeout) {\n        return;\n      }\n      next(_this).then(function (reports) {\n        if (_this._timeout !== timeout) {\n          return;\n        }\n        if (reports.length) {\n          var _a = __read(reports, 1),\n            report = _a[0];\n          _this._signaling.put(report);\n        }\n        _this.start();\n      });\n    }, 200);\n    this._timeout = timeout;\n  };\n  /**\n   * Stop monitoring.\n   * @returns {void}\n   */\n  NetworkQualityMonitor.prototype.stop = function () {\n    clearTimeout(this._timeout);\n    this._timeout = null;\n  };\n  return NetworkQualityMonitor;\n}(EventEmitter);\n/**\n * @param {NetworkQualityMonitor}\n * @returns {Promise<NetworkQualityInputs>}\n */\nfunction next(monitor) {\n  var pcv2s = monitor._manager._peerConnections ? Array.from(monitor._manager._peerConnections.values()) : [];\n  var pcs = pcv2s.map(function (pcv2) {\n    return pcv2._peerConnection;\n  }).filter(function (pc) {\n    return pc.signalingState !== 'closed';\n  });\n  var factories = pcs.map(function (pc) {\n    if (monitor._factories.has(pc)) {\n      return monitor._factories.get(pc);\n    }\n    var factory = new PeerConnectionReportFactory(pc);\n    monitor._factories.set(pc, factory);\n    return factory;\n  });\n  var reportsOrNullPromises = factories.map(function (factory) {\n    return factory.next().catch(function () {\n      return null;\n    });\n  });\n  return Promise.all(reportsOrNullPromises).then(function (reportsOrNull) {\n    return reportsOrNull.filter(function (reportOrNull) {\n      return reportOrNull;\n    }).map(function (report) {\n      return report.summarize();\n    });\n  });\n}\n/**\n * The {@link NetworkQualityLevel} changed.\n * @event NetworkQualityMonitor#updated\n */\nmodule.exports = NetworkQualityMonitor;","map":{"version":3,"mappings":"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","names":["EventEmitter","require","PeerConnectionReportFactory","__extends","manager","signaling","_super","Object","defineProperties","_this","_factories","value","WeakMap","_manager","_signaling","on","emit","NetworkQualityMonitor","level","levels","remoteLevels","stop","timeout","setTimeout","_timeout","next","then","reports","length","report","put","start","clearTimeout","monitor","pcv2s","_peerConnections","Array","from","values","pcs","map","_peerConnection","filter","signalingState","factories","has","pc","get","factory","set","reportsOrNullPromises","catch","Promise","all","summarize","module","exports"],"sources":["/Users/aarushisingh/Projects/counteroffer/client/node_modules/twilio-video/lib/signaling/v2/networkqualitymonitor.js"],"sourcesContent":["/* eslint callback-return:0 */\n'use strict';\n\nconst EventEmitter = require('events');\n\nconst PeerConnectionReportFactory = require('../../stats/peerconnectionreportfactory');\n\n/**\n * @emits NetworkQualityMonitor#updated\n */\nclass NetworkQualityMonitor extends EventEmitter {\n  /**\n   * Construct a {@link NetworkQualityMonitor}.\n   * @param {PeerConnectionManager} manager\n   * @param {NetworkQualitySignaling} signaling\n   */\n  constructor(manager, signaling) {\n    super();\n    Object.defineProperties(this, {\n      _factories: {\n        value: new WeakMap()\n      },\n      _manager: {\n        value: manager\n      },\n      _signaling: {\n        value: signaling\n      }\n    });\n    signaling.on('updated', () => this.emit('updated'));\n  }\n\n  /**\n   * Get the current {@link NetworkQualityLevel}, if any.\n   * @returns {?NetworkQualityLevel} level - initially null\n   */\n  get level() {\n    return this._signaling.level;\n  }\n\n  /**\n   * Get the current {@link NetworkQualityLevels}, if any.\n   * @returns {?NetworkQualityLevels} levels - initially null\n   */\n  get levels() {\n    return this._signaling.levels;\n  }\n\n  /**\n   * Get the current {@link NetworkQualityLevels} of remote participants, if any.\n   * @returns {Map<String, NetworkQualityLevels>} remoteLevels\n   */\n  get remoteLevels() {\n    return this._signaling.remoteLevels;\n  }\n\n  /**\n   * Start monitoring.\n   * @returns {void}\n   */\n  start() {\n    this.stop();\n    const timeout = setTimeout(() => {\n      if (this._timeout !== timeout) {\n        return;\n      }\n      next(this).then(reports => {\n        if (this._timeout !== timeout) {\n          return;\n        }\n        if (reports.length) {\n          const [report] = reports;\n          this._signaling.put(report);\n        }\n        this.start();\n      });\n    }, 200);\n    this._timeout = timeout;\n  }\n\n  /**\n   * Stop monitoring.\n   * @returns {void}\n   */\n  stop() {\n    clearTimeout(this._timeout);\n    this._timeout = null;\n  }\n}\n\n/**\n * @param {NetworkQualityMonitor}\n * @returns {Promise<NetworkQualityInputs>}\n */\nfunction next(monitor) {\n  const pcv2s = monitor._manager._peerConnections\n    ? Array.from(monitor._manager._peerConnections.values())\n    : [];\n\n  const pcs = pcv2s\n    .map(pcv2 => pcv2._peerConnection)\n    .filter(pc => pc.signalingState !== 'closed');\n\n  const factories = pcs.map(pc => {\n    if (monitor._factories.has(pc)) {\n      return monitor._factories.get(pc);\n    }\n    const factory = new PeerConnectionReportFactory(pc);\n    monitor._factories.set(pc, factory);\n    return factory;\n  });\n\n  const reportsOrNullPromises = factories.map(factory => factory.next().catch(() => null));\n\n  return Promise.all(reportsOrNullPromises).then(reportsOrNull => reportsOrNull\n    .filter(reportOrNull => reportOrNull)\n    .map(report => report.summarize()));\n}\n\n/**\n * The {@link NetworkQualityLevel} changed.\n * @event NetworkQualityMonitor#updated\n */\n\nmodule.exports = NetworkQualityMonitor;\n"]},"metadata":{},"sourceType":"script","externalDependencies":[]}