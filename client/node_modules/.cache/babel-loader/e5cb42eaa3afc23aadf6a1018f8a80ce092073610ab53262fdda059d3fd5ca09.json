{"ast":null,"code":"/* eslint callback-return:0 */\n'use strict';\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n    return extendStatics(d, b);\n  };\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nvar EventEmitter = require('events');\nvar nInstances = 0;\nvar MediaSignaling = /** @class */function (_super) {\n  __extends(MediaSignaling, _super);\n  /**\n   * Construct a {@link MediaSignaling}.\n   * @param {Promise<DataTrackReceiver>} getReceive\n   * @param {string} channel\n   */\n  function MediaSignaling(getReceiver, channel, options) {\n    var _this = _super.call(this) || this;\n    Object.defineProperties(_this, {\n      _instanceId: {\n        value: nInstances++\n      },\n      channel: {\n        value: channel\n      },\n      _log: {\n        value: options.log.createLog('default', _this)\n      },\n      _getReceiver: {\n        value: getReceiver\n      },\n      _receiverPromise: {\n        value: null,\n        writable: true\n      },\n      _transport: {\n        value: null,\n        writable: true\n      }\n    });\n    return _this;\n  }\n  Object.defineProperty(MediaSignaling.prototype, \"isSetup\", {\n    get: function () {\n      return !!this._receiverPromise;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  MediaSignaling.prototype.toString = function () {\n    return \"[MediaSignaling #\" + this._instanceId + \":\" + this.channel + \"]\";\n  };\n  MediaSignaling.prototype.setup = function (id) {\n    var _this = this;\n    this._teardown();\n    this._log.info('setting up msp transport for id:', id);\n    var receiverPromise = this._getReceiver(id).then(function (receiver) {\n      if (receiver.kind !== 'data') {\n        _this._log.error('Expected a DataTrackReceiver');\n      }\n      if (_this._receiverPromise !== receiverPromise) {\n        return;\n      }\n      try {\n        _this._transport = receiver.toDataTransport();\n        _this.emit('ready', _this._transport);\n      } catch (ex) {\n        _this._log.error(\"Failed to toDataTransport: \" + ex.message);\n      }\n      receiver.once('close', function () {\n        return _this._teardown();\n      });\n    });\n    this._receiverPromise = receiverPromise;\n  };\n  MediaSignaling.prototype._teardown = function () {\n    if (this._transport) {\n      this._log.info('Tearing down');\n      this._transport = null;\n      this._receiverPromise = null;\n      this.emit('teardown');\n    }\n  };\n  return MediaSignaling;\n}(EventEmitter);\nmodule.exports = MediaSignaling;","map":{"version":3,"mappings":"AAAA;AACA,YAAY;;;;;;;;;;;;;;;;;;;;;;AAEZ,IAAMA,YAAY,GAAGC,OAAO,CAAC,QAAQ,CAAC;AAEtC,IAAIC,UAAU,GAAG,CAAC;AAClB;EAA6BC;EAC3B;;;;;EAKA,wBAAYC,WAAW,EAAEC,OAAO,EAAEC,OAAO;IAAzC,YACEC,iBAAO;IACPC,MAAM,CAACC,gBAAgB,CAACC,KAAI,EAAE;MAC5BC,WAAW,EAAE;QACXC,KAAK,EAAEV,UAAU;OAClB;MACDG,OAAO,EAAE;QACPO,KAAK,EAAEP;OACR;MACDQ,IAAI,EAAE;QACJD,KAAK,EAAEN,OAAO,CAACQ,GAAG,CAACC,SAAS,CAAC,SAAS,EAAEL,KAAI;OAC7C;MACDM,YAAY,EAAE;QACZJ,KAAK,EAAER;OACR;MACDa,gBAAgB,EAAE;QAChBL,KAAK,EAAE,IAAI;QACXM,QAAQ,EAAE;OACX;MACDC,UAAU,EAAE;QACVP,KAAK,EAAE,IAAI;QACXM,QAAQ,EAAE;;KAEb,CAAC;;EACJ;EAEAV,sBAAIY,mCAAO;SAAX;MACE,OAAO,CAAC,CAAC,IAAI,CAACH,gBAAgB;IAChC,CAAC;;;;EAEDG,iCAAQ,GAAR;IACE,OAAO,sBAAoB,IAAI,CAACT,WAAW,SAAI,IAAI,CAACN,OAAO,MAAG;EAChE,CAAC;EAEDe,8BAAK,GAAL,UAAMC,EAAE;IAAR;IACE,IAAI,CAACC,SAAS,EAAE;IAChB,IAAI,CAACT,IAAI,CAACU,IAAI,CAAC,kCAAkC,EAAEF,EAAE,CAAC;IACtD,IAAMG,eAAe,GAAG,IAAI,CAACR,YAAY,CAACK,EAAE,CAAC,CAACI,IAAI,CAAC,kBAAQ;MACzD,IAAIC,QAAQ,CAACC,IAAI,KAAK,MAAM,EAAE;QAC5BjB,KAAI,CAACG,IAAI,CAACe,KAAK,CAAC,8BAA8B,CAAC;;MAC/C,IAAIlB,KAAI,CAACO,gBAAgB,KAAKO,eAAe,EAAE;QAC/C;;MAGF,IAAI;QACFd,KAAI,CAACS,UAAU,GAAGO,QAAQ,CAACG,eAAe,EAAE;QAC5CnB,KAAI,CAACoB,IAAI,CAAC,OAAO,EAAEpB,KAAI,CAACS,UAAU,CAAC;OACpC,CAAC,OAAOY,EAAE,EAAE;QACXrB,KAAI,CAACG,IAAI,CAACe,KAAK,CAAC,gCAA8BG,EAAE,CAACC,OAAS,CAAC;;MAE7DN,QAAQ,CAACO,IAAI,CAAC,OAAO,EAAE;QAAM,YAAI,CAACX,SAAS,EAAE;MAAhB,CAAgB,CAAC;IAChD,CAAC,CAAC;IACF,IAAI,CAACL,gBAAgB,GAAGO,eAAe;EACzC,CAAC;EAEDJ,kCAAS,GAAT;IACE,IAAI,IAAI,CAACD,UAAU,EAAE;MACnB,IAAI,CAACN,IAAI,CAACU,IAAI,CAAC,cAAc,CAAC;MAC9B,IAAI,CAACJ,UAAU,GAAG,IAAI;MACtB,IAAI,CAACF,gBAAgB,GAAG,IAAI;MAC5B,IAAI,CAACa,IAAI,CAAC,UAAU,CAAC;;EAEzB,CAAC;EACH,qBAAC;AAAD,CAAC,CArE4B9B,YAAY;AAuEzCkC,MAAM,CAACC,OAAO,GAAGf,cAAc","names":["EventEmitter","require","nInstances","__extends","getReceiver","channel","options","_super","Object","defineProperties","_this","_instanceId","value","_log","log","createLog","_getReceiver","_receiverPromise","writable","_transport","MediaSignaling","id","_teardown","info","receiverPromise","then","receiver","kind","error","toDataTransport","emit","ex","message","once","module","exports"],"sources":["/Users/aarushisingh/Projects/counteroffer/client/node_modules/twilio-video/lib/signaling/v2/mediasignaling.js"],"sourcesContent":["/* eslint callback-return:0 */\n'use strict';\n\nconst EventEmitter = require('events');\n\nlet nInstances = 0;\nclass MediaSignaling extends EventEmitter {\n  /**\n   * Construct a {@link MediaSignaling}.\n   * @param {Promise<DataTrackReceiver>} getReceive\n   * @param {string} channel\n   */\n  constructor(getReceiver, channel, options) {\n    super();\n    Object.defineProperties(this, {\n      _instanceId: {\n        value: nInstances++\n      },\n      channel: {\n        value: channel,\n      },\n      _log: {\n        value: options.log.createLog('default', this)\n      },\n      _getReceiver: {\n        value: getReceiver\n      },\n      _receiverPromise: {\n        value: null,\n        writable: true,\n      },\n      _transport: {\n        value: null,\n        writable: true\n      }\n    });\n  }\n\n  get isSetup() {\n    return !!this._receiverPromise;\n  }\n\n  toString() {\n    return `[MediaSignaling #${this._instanceId}:${this.channel}]`;\n  }\n\n  setup(id) {\n    this._teardown();\n    this._log.info('setting up msp transport for id:', id);\n    const receiverPromise = this._getReceiver(id).then(receiver => {\n      if (receiver.kind !== 'data') {\n        this._log.error('Expected a DataTrackReceiver');\n      } if (this._receiverPromise !== receiverPromise) {\n        return;\n      }\n\n      try {\n        this._transport = receiver.toDataTransport();\n        this.emit('ready', this._transport);\n      } catch (ex) {\n        this._log.error(`Failed to toDataTransport: ${ex.message}`);\n      }\n      receiver.once('close', () => this._teardown());\n    });\n    this._receiverPromise = receiverPromise;\n  }\n\n  _teardown() {\n    if (this._transport) {\n      this._log.info('Tearing down');\n      this._transport = null;\n      this._receiverPromise = null;\n      this.emit('teardown');\n    }\n  }\n}\n\nmodule.exports = MediaSignaling;\n"]},"metadata":{},"sourceType":"script","externalDependencies":[]}